const fs = require('fs');
const path = require('path');

// ‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
const dataFilePath = path.join(__dirname, 'sndjw.json');

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå
function loadData() {
  if (!fs.existsSync(dataFilePath)) {
    fs.writeFileSync(dataFilePath, JSON.stringify({}));
  }
  const rawData = fs.readFileSync(dataFilePath);
  return JSON.parse(rawData);
}

module.exports = {
  name: 'money',
  description: '‡∏î‡∏π‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢)',
  execute(bot) {
    // ‡∏à‡∏±‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á /‡πÄ‡∏á‡∏¥‡∏ô
    bot.onText(/\/‡πÄ‡∏á‡∏¥‡∏ô/, (msg) => {
      const chatId = msg.chat.id;
      const userId = msg.from.id;

      // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô
      const data = loadData();

      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if (!data[userId]) {
        data[userId] = { balance: 0 }; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏õ‡πá‡∏ô 0
        fs.writeFileSync(dataFilePath, JSON.stringify(data, null, 2));
      }

      // ‡∏™‡πà‡∏á‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
      const balance = data[userId].balance;
      bot.sendMessage(chatId, `üí∞ ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: ${formatMoney(balance)}`);
    });
  },
};

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÄ‡∏á‡∏¥‡∏ô (‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢)
function formatMoney(amount) {
  const baht = Math.floor(amount);
  const satang = Math.round((amount - baht) * 100);
  return `${baht} ‡∏ö‡∏≤‡∏ó ${satang} ‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå`;
}
